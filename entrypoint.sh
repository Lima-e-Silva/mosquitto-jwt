#!/bin/sh
set -e
# ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
# Secret
# ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
if [ -z "${JWT_SECRET}" ]; then
  echo "ERRO: JWT_SECRET not defined."
  exit 1
fi
echo -n "${JWT_SECRET}" > /mosquitto/config/jwt_secret.key
# ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
# Permissões
# ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
chown mosquitto:mosquitto /mosquitto/config/jwt_secret.key
chmod 600 /mosquitto/config/jwt_secret.key
# ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
exec "$@"